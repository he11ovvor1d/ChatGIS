<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
 <script src="https://cdn.jsdelivr.net/npm/leaflet-geoman-postgis/dist/leaflet-geoman-postgis.min.js"></script>
<script src="https://unpkg.com/leaflet-wfst@0.2.0/dist/leaflet-wfst.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


</head>
<body>
  <div id="map" style="height: 700px;;"></div>
  
  <label for="input">请输入：</label>
	<input type="text" id="param1">
	<button id="submit">提交</button>

  <script>
    var map = L.map('map', {
   preferCanvas: true,
     crs: L.CRS.EPSG4326,
     minZoom: 3,
     maxZoom: 20,
     center: [32, 119],
     zoom: 9,
 });
 
 L.tileLayer('http://t1.tianditu.com/vec_c/wmts?layer=vec&style=default&tilematrixset=c&Service=WMTS&Request=GetTile&Version=1.0.0&Format=tiles&TileMatrix={z}&TileCol={x}&TileRow={y}&tk=382955e6b2139c90c0f30cbca600caaf', {
         maxZoom: 20,
         tileSize: 256,
         zoomOffset: 1,

     }).addTo(map);  
    L.tileLayer('http://t1.tianditu.com/cva_c/wmts?layer=cva&style=default&tilematrixset=c&Service=WMTS&Request=GetTile&Version=1.0.0&Format=tiles&TileMatrix={z}&TileCol={x}&TileRow={y}&tk=382955e6b2139c90c0f30cbca600caaf', {
         maxZoom: 20,
         tileSize: 256,
         zoomOffset: 1,

     }).addTo(map);  

  L.tileLayer.wms('http://localhost:8080/geoserver/wms', {
    layers: 'nj:NJ',
    format: 'image/png',
    transparent: true
  }).addTo(map);
  var geojsonLayer = L.geoJSON().addTo(map);
  $("#submit").click(function(){
  geojsonLayer.clearLayers();
  executeQuery(document.getElementById("param1").value);
  }
);


function executeQuery(nl) {
  // 创建一个FormData对象，用于包装POST请求的参数
  var formData = new FormData();
  formData.append('data', nl);
  // 发送POST请求到API端点
  fetch('http://localhost:8000/process_data', {
    method: 'POST',
    body: formData
  })
  .then(response => response.json())
  .then(
    json => {
    json.features.forEach(function(feature){
      geojsonLayer.addData(feature)
      })
      map.fitBounds(geojsonLayer.getBounds());
  })
  .catch(error => {
    console.error('Error:', error);
  });
}
</script>
</body>
</html>